(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4e59c539"],{"4cae":function(t,e,a){},5627:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.categoryDetail?a("div",{staticClass:"container category-list"},[a("div",{staticClass:"edit-area"},[a("a",{staticClass:"editor-button confirm-button",attrs:{href:"#confirm"},on:{click:function(e){return e.preventDefault(),t.saveCategory()}}},[a("font-awesome-icon",{attrs:{icon:"check"}})],1),a("div",{staticClass:"field product-edit-language hidden"},[a("label",{staticClass:"label",attrs:{translate:"yes"}},[t._v("Edit Language")]),a("div",{staticClass:"control select"},[a("select",{directives:[{name:"model",rawName:"v-model",value:t.newLanguage,expression:"newLanguage"}],on:{change:[function(e){var a=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){var e="_value"in t?t._value:t.value;return e});t.newLanguage=e.target.multiple?a:a[0]},function(e){return t.changeEditedLang()}]}},t._l(t.$store.state.coredata.langs,function(e,s){return a("option",{key:s+"langs",domProps:{value:e}},[t._v("\n            "+t._s(e.name)+"\n          ")])}),0)])])]),t.editing?a("div",{staticClass:"category-hidden-properties"},[a("b-collapse",{attrs:{open:!1,"aria-id":"contentHiddenProperties"},scopedSlots:t._u([{key:"trigger",fn:function(e){return a("h3",{staticClass:"title is-3",attrs:{"aria-controls":"contentHiddenProperties",translate:"yes"}},[t._v("\n        Category's hidden properties "),a("font-awesome-icon",{attrs:{icon:e.open?"angle-down":"angle-up"}})],1)}}],null,!1,1177212821)},[a("div",{staticClass:"editableByAuthor-hidden collapse-content",attrs:{id:"contentHiddenProperties","aria-expanded":"true"}},[a("div",{staticClass:"columns"},[a("div",{staticClass:"column is-12"},[t.editing?a("div",{staticClass:"columns"},[a("div",{staticClass:"column is-3"},[a("div",{staticClass:"field"},[a("label",{staticClass:"label",attrs:{translate:"yes"}},[t._v("Type")]),a("div",{staticClass:"control"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.categoryDetail.type,expression:"categoryDetail.type"}],staticClass:"input",attrs:{type:"text",translate:"yes",placeholder:"Type"},domProps:{value:t.categoryDetail.type},on:{input:function(e){e.target.composing||t.$set(t.categoryDetail,"type",e.target.value)}}})])])]),a("div",{staticClass:"column is-3"},[a("div",{staticClass:"field"},[a("label",{staticClass:"label",attrs:{translate:"yes"}},[t._v("Subtype")]),a("div",{staticClass:"control"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.categoryDetail.subtype,expression:"categoryDetail.subtype"}],staticClass:"input",attrs:{type:"text",translate:"yes",placeholder:"Subtype"},domProps:{value:t.categoryDetail.subtype},on:{input:function(e){e.target.composing||t.$set(t.categoryDetail,"subtype",e.target.value)}}})])])]),a("div",{staticClass:"column is-3"},[a("div",{staticClass:"field"},[a("label",{staticClass:"label",attrs:{translate:"yes"}},[t._v("External Id")]),a("div",{staticClass:"control"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.categoryDetail.externalId,expression:"categoryDetail.externalId"}],staticClass:"input",attrs:{type:"text",translate:"yes",placeholder:"External Id"},domProps:{value:t.categoryDetail.externalId},on:{input:function(e){e.target.composing||t.$set(t.categoryDetail,"externalId",e.target.value)}}})])])])]):t._e()])]),a("div",{staticClass:"columns"},[a("div",{staticClass:"column is-12"},[t.editing?a("div",{staticClass:"columns"},[a("div",{staticClass:"column is-3"},[a("div",{staticClass:"field"},[a("label",{staticClass:"label",attrs:{translate:"yes"}},[t._v("Slug")]),a("div",{staticClass:"control"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.categoryDetail.slug,expression:"categoryDetail.slug"}],staticClass:"input",attrs:{type:"text",translate:"yes",placeholder:"Slug"},domProps:{value:t.categoryDetail.slug},on:{input:function(e){e.target.composing||t.$set(t.categoryDetail,"slug",e.target.value)}}})])])]),a("div",{staticClass:"column is-6"},[a("div",{staticClass:"field"},[a("label",{staticClass:"label",attrs:{translate:"yes"}},[t._v("Note")]),a("div",{staticClass:"control"},[a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.categoryDetail.note,expression:"categoryDetail.note"}],staticClass:"textarea",attrs:{translate:"yes",placeholder:"Note"},domProps:{value:t.categoryDetail.note},on:{input:function(e){e.target.composing||t.$set(t.categoryDetail,"note",e.target.value)}}})])])]),a("div",{staticClass:"column is-3"},[a("div",{staticClass:"field"},[a("label",{staticClass:"label",attrs:{translate:"yes"}},[t._v("Activity")]),a("div",{staticClass:"control"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.categoryDetail.activity,expression:"categoryDetail.activity"}],staticClass:"input",attrs:{type:"text",translate:"yes",placeholder:"Activity"},domProps:{value:t.categoryDetail.activity},on:{input:function(e){e.target.composing||t.$set(t.categoryDetail,"activity",e.target.value)}}})])])])]):t._e()])])])]),t.user&&null!=t.user&&t.user.type&&"admin"==t.user.type?a("div",[a("b-collapse",{attrs:{open:!1,"aria-id":"contentHiddenPropertiesAdmin"},scopedSlots:t._u([{key:"trigger",fn:function(e){return a("h3",{staticClass:"title is-3",attrs:{"aria-controls":"contentHiddenProperties",translate:"yes"}},[t._v("\n          Editable by admin user "),a("font-awesome-icon",{attrs:{icon:e.open?"angle-down":"angle-up"}})],1)}}],null,!1,1052534601)},[a("div",{staticClass:"editableByAdmin-hidden"},[a("div",{staticClass:"columns"},[a("div",{staticClass:"column is-4 is-offset-4"},[a("div",{staticClass:"field"},[a("label",{staticClass:"label",attrs:{translate:"yes"}},[t._v("Publisher")]),a("div",{staticClass:"control"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.categoryDetail.publisher,expression:"categoryDetail.publisher"}],staticClass:"input",attrs:{type:"text",translate:"yes",placeholder:"Publisher"},domProps:{value:t.categoryDetail.publisher},on:{input:function(e){e.target.composing||t.$set(t.categoryDetail,"publisher",e.target.value)}}})])])])])])])],1):t._e()],1):t._e(),a("div",{staticClass:"columns category-header",style:{backgroundImage:"url("+t.getCategoryBackground()+")"}},[a("div",{staticClass:"column"},[a("div",{staticClass:"category-image-wrapper"},[a("b-field",{staticClass:"file action edit"},[a("b-upload",{on:{input:function(e){return t.categoryMainImageUpload()}},model:{value:t.categoryMainImageFile,callback:function(e){t.categoryMainImageFile=e},expression:"categoryMainImageFile"}},[a("a",{staticClass:"button is-primary is-info"},[a("i",{staticClass:"fa fa-file-upload"}),t._v(" \n              "),a("span",{attrs:{translate:"yes"}},[t._v("Click to upload")])])])],1),a("a",{staticClass:"action remove button is-danger is-outlined",on:{click:function(e){return e.preventDefault(),t.categoryMainImageDelete()}}},[a("i",{staticClass:"fa fa-trash"}),t._v("  \n          "),a("span",{attrs:{translate:"yes"}},[t._v("Click to remove")])])],1),t.categoryDetail?a("h1",{staticClass:"title is-1"},[t._v(t._s(t.categoryDetail.name[t.language.code]))]):t._e(),t.categoryDetail?a("h2",{staticClass:"title is-3"},[t._v(t._s(t.categoryDetail.descriptionShort[t.language.code]))]):t._e(),t.categoryDetail?a("p",{},[t._v(t._s(t.categoryDetail.descriptionLong[t.language.code]))]):a("h1",{staticClass:"title is-1 title-products",attrs:{translate:"yes"}},[t._v("Products")])])]),a("div",{staticClass:"columns"},[a("div",{staticClass:"column data-main"},[a("div",{staticClass:"field"},[a("label",{staticClass:"label",attrs:{translate:"yes"}},[t._v("Name")]),a("div",{staticClass:"control"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.categoryDetail.name[t.language.code],expression:"categoryDetail.name[language.code]"}],staticClass:"input is-size-1 has-text-weight-semibold has-text-centered",attrs:{type:"text",translate:"yes",placeholder:"Name"},domProps:{value:t.categoryDetail.name[t.language.code]},on:{input:function(e){e.target.composing||t.$set(t.categoryDetail.name,t.language.code,e.target.value)}}})])]),a("div",{staticClass:"field"},[a("label",{staticClass:"label",attrs:{translate:"yes"}},[t._v("Description Short")]),a("div",{staticClass:"control"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.categoryDetail.descriptionShort[t.language.code],expression:"categoryDetail.descriptionShort[language.code]"}],staticClass:"input is-size-5 has-text-weight-normal has-text-centered",attrs:{type:"text",translate:"yes",placeholder:"Description Short"},domProps:{value:t.categoryDetail.descriptionShort[t.language.code]},on:{input:function(e){e.target.composing||t.$set(t.categoryDetail.descriptionShort,t.language.code,e.target.value)}}})])]),a("div",{staticClass:"field"},[a("label",{staticClass:"label",attrs:{translate:"yes"}},[t._v("Description Long")]),a("div",{staticClass:"control"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.categoryDetail.descriptionLong[t.language.code],expression:"categoryDetail.descriptionLong[language.code]"}],staticClass:"input is-size-5 has-text-weight-normal has-text-centered",attrs:{type:"text",translate:"yes",placeholder:"Description Long"},domProps:{value:t.categoryDetail.descriptionLong[t.language.code]},on:{input:function(e){e.target.composing||t.$set(t.categoryDetail.descriptionLong,t.language.code,e.target.value)}}})])])])]),a("div",{staticClass:"columns"},[a("div",{staticClass:"column is-3"},[t.categoryDetail&&t.categoryDetail.subs?a("nav",{staticClass:"panel"},[a("p",{staticClass:"panel-heading",attrs:{translate:"yes"}},[t._v("\n          Sub-Categories\n        ")]),t._l(this.categoryDetail.subs,function(e,s){return a("router-link",{key:s,staticClass:"panel-block",attrs:{title:e.descriptionShort[t.language.code],to:{name:"categoryList",params:{category:e.pathSlug}}}},[t._v("\n          "+t._s(e.name[t.language.code])+"\n        ")])})],2):t._e()]),a("div",{staticClass:"column is-9"},[a("section",[a("b-field",{attrs:{label:"Enter parent categories' url slugs"}},[a("b-taginput",{attrs:{data:t.filteredCategoriesSlugs,autocomplete:"","allow-new":!1,field:"user.first_name",icon:"tags",placeholder:"Parent Categories",type:"is-info"},on:{typing:t.getFilteredCategories},model:{value:t.categoryDetail.parentPath,callback:function(e){t.$set(t.categoryDetail,"parentPath",e)},expression:"categoryDetail.parentPath"}})],1)],1),t.breadcrumbs&&null!=t.breadcrumbs&&t.breadcrumbs.length>0?a("nav",{staticClass:"breadcrumb",attrs:{"aria-label":"breadcrumbs"}},[a("ul",[t._l(t.breadcrumbs,function(e,s){return a("li",{key:s},[a("router-link",{attrs:{title:e.name[t.language.code],to:{name:"categoryList",params:{category:e.pathSlug}}}},[t._v("\n              "+t._s(e.name[t.language.code])+"\n            ")])],1)}),a("li",{staticClass:"is-active"},[a("router-link",{attrs:{title:t.categoryDetail.name[t.language.code],to:{name:"categoryList",params:{category:t.categoryDetail.pathSlug}},"aria-current":"page"}},[t._v("\n              "+t._s(t.categoryDetail.name[t.language.code])+"\n            ")])],1)],2)]):t._e()])]),this.categoryDetail&&null!=this.categoryDetail?a("div",{staticClass:"columns category-delete"},[a("div",{staticClass:"column is-12"},[a("section",[a("button",{staticClass:"button is-danger",on:{click:function(e){return t.deleteCategory()}}},[t._v("DELETE This Category")]),a("p",[t._v("Warning: This action cannot be undone! This action does not remove category's content!")])])])]):t._e()]):t._e()},i=[],l=(a("28a5"),a("6b54"),a("df7c"),a("5b55"),{name:"CategoryNewEdit",data:function(){return{categories:[],filteredProductsCount:null,products:[],categoryMainImageFile:null,breadcrumbs:[],categoryDetail:null,language:{code:"en",longCode:"en-US",name:"English"},newLanguage:null,editing:!1,userEditAllowed:!1,groupsLastRefresh:0,filteredCategoriesSlugs:[],fireCounter:0}},created:function(){this.language=this.$store.state.language},computed:{user:function(){return this.$store.getters.getUserProfile}},components:{},watch:{user:function(t,e){console.log("new & old",t,e),t&&null!=t&&(this.getUserEditAllowed(),this.userEditAllowed&&this.getCategoryDetail())}},mounted:function(){this.getUserEditAllowed(),console.log("mounted this.userEditAllowed",this.userEditAllowed),this.userEditAllowed&&this.getCategoryDetail()},methods:{getUserEditAllowed:function(){if(this.language=this.$store.state.language,this.user&&null!=this.user&&this.user.type&&"admin"==this.user.type)return this.userEditAllowed=!0,void(this.user.settings.language&&(this.language=this.$store.state.language));this.userEditAllowed=!1},changeEditedLang:function(){this.fireCounter++,this.editing&&this.newLanguage&&this.newLanguage.code&&1==this.fireCounter&&(window.location=window.location.origin+this.$route.path+"?lang="+this.newLanguage.code)},processCategoryResponse:function(t){var e=new Date;this.groupsLastRefresh=e.getTime(),t.data&&(this.categoryDetail=t.data,t.data.parentCategories&&(this.breadcrumbs=t.data.parentCategories),this.editing=!0,this.newLanguage=this.language),t.data.categories&&(this.categories=t.data.categories)},getCategoryDetail:function(){var t=this;this.$route.params&&this.$route.params.category&&""!=this.$route.params.category.toString().trim()&&("---new"==this.$route.params.category.toString().trim()?setTimeout(function(){t.categoryDetail=t.getEmptyCategory(),t.editing=!0},1e3):this.$httpc.get("category/"+this.$route.params.category,{timeout:7e3}).then(function(e){t.processCategoryResponse(e)}).catch(function(t){console.log(t)}))},getFilteredCategories:function(t){var e=this;return t&&""!=t.toString().trim()?this.$httpc.post("categories/find",{query:{pathSlug:{$regex:t},type:e.categoryDetail&&e.categoryDetail.type?e.categoryDetail.type:"products"}}).then(function(t){if(t.data)return t.data}).catch(function(t){console.log(t)}).then(function(t){for(var a=[],s=0;s<t.length;s++)e.categoryDetail.parentPath.indexOf(t[s].pathSlug)<0&&a.push(t[s].pathSlug);return e.filteredCategoriesSlugs=a,a}):(e.filteredCategoriesSlugs=[],[])},getCategoryBackground:function(){return this.categoryDetail&&this.categoryDetail.slug&&this.$store.state.coredata&&this.$store.state.coredata.settings&&this.$store.state.coredata.settings.assets&&this.$store.state.coredata.settings.assets.url?this.$helpers.getImagePath("categories",this.$store.state.coredata,this.categoryDetail.slug,this.categoryDetail.slug+".jpg"):""},categoryMainImageUpload:function(){if(console.log("categoryMainImageFile:",this.categoryMainImageFile),this.categoryMainImageFile){var t=this,e=new FormData;if(this.categoryMainImageFile.length&&this.categoryMainImageFile.length>0)for(var a=0;a<this.categoryMainImageFile.length;a++){var s=this.categoryMainImageFile[a];e.append("files["+a+"]",s)}else e.append("files[0]",this.categoryMainImageFile);this.$httpc.post("/categories/upload/"+this.categoryDetail.slug,e,{needsAuth:!0}).then(function(e){if(e&&e.data&&"'"==e.data.substr(0,1)&&"'"==e.data[e.data.length-1]){var a=e.data.length-2;if(e.data=e.data.substr(1,a),e.data=JSON.parse(e.data),e.data.files&&e.data.files.length>0&&e.data.files[0].path&&""!=e.data.files[0].path.trim()){var s=t.$el.querySelector(".category-list .category-header");s&&s.setAttribute("style","background-image: url('"+t.$store.state.coredata.settings.assets.url+"/categories/"+e.data.files[0].path+"')")}}})}},categoryMainImageDelete:function(){var t=this;if(confirm("Are you sure?")){var e={timeout:15e3,needsAuth:!0},a=this.getCategoryBackground(this.categoryDetail.slug),s="";if(""!=a.trim()){var i=a.split("/");i.length>0&&(s=i[i.length-1])}console.log(this.categoryDetail.slug,a),this.$httpc.delete("user/image/categories/"+this.categoryDetail.slug+"/"+s,e).then(function(e){e&&e.data&&e.data.success&&(console.log("image delete response",e.data),t.$el.querySelector(".category-list .category-header").setAttribute("style",""))})}},saveCategory:function(){var t=this,e=this.categoryDetail;e&&e._id&&!e.id&&(e.id=e._id),e.parentCategories&&delete e.parentCategories,e.subs&&delete e.subs,e.subsSlugs&&delete e.subsSlugs,e.count&&delete e.count,e.minMaxPrice&&delete e.minMaxPrice;var a={categories:[]};a.categories.push(e),this.$httpc.put("categories",a,{needsAuth:!0}).then(function(e){if(e.data&&e.data.length>0){var a=e.data[0],s=t.$router.resolve({name:"categoryNewEdit",params:{category:a.pathSlug}});window.location=s.href}}).catch(function(t){console.log("saveCategory error:",t)})},deleteCategory:function(){var t=this,e={categories:[{id:t.categoryDetail._id}]};this.categoryDetail&&this.categoryDetail._id&&confirm("Are you sure you want to delete this product?")&&this.$httpc.delete("categories",{data:e}).then(function(t){t&&t.data&&alert("Category has been successfully removed. You will be redirected now")})},getEmptyCategory:function(){var t=this;return{externalId:null,publisher:t.$store.state.user.email,slug:null,pathSlug:null,parentPath:[],parentPathSlug:null,type:"products",subtype:"physical",name:t.$helpers.getLangsEmptyObject(t.$store.state.coredata.langCodes),descriptionShort:t.$helpers.getLangsEmptyObject(t.$store.state.coredata.langCodes),descriptionLong:t.$helpers.getLangsEmptyObject(t.$store.state.coredata.langCodes),categories:[],dates:{dateCreated:null,dateUpdated:null,dateSynced:null},data:{},note:null}}}}),r=l,o=(a("cbdb"),a("2877")),n=Object(o["a"])(r,s,i,!1,null,"2b826706",null);e["default"]=n.exports},cbdb:function(t,e,a){"use strict";var s=a("4cae"),i=a.n(s);i.a}}]);
//# sourceMappingURL=chunk-4e59c539.53725690.js.map